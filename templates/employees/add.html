{% extends "base.html" %}

{% block title %}إضافة موظف جديد - نظام رايزو للموارد البشرية{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0"><i class="fas fa-user-plus"></i> إضافة موظف جديد</h4>
                </div>
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data" id="employeeForm">
                        {{ form.hidden_tag() }}
                        
                        <!-- بيانات الموظف -->
                        <div class="card mb-4">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0"><i class="fas fa-user"></i> بيانات الموظف</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <!-- صورة الموظف -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.employee_photo.label(class="form-label") }}
                                        <span class="text-danger">*</span>
                                        {{ form.employee_photo(class="form-control") }}
                                        {% if form.employee_photo.errors %}
                                            <div class="text-danger">{{ form.employee_photo.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- الرقم الوظيفي -->
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">الرقم الوظيفي</label>
                                        <input type="text" class="form-control" value="سيتم توليده تلقائياً (يبدأ من 1001)" readonly>
                                        <small class="text-muted">سيتم توليد الرقم الوظيفي تلقائياً عند الحفظ</small>
                                    </div>
                                    
                                    <!-- اسم الموظف بالعربي -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.name_arabic.label(class="form-label") }}
                                        <span class="text-danger">*</span>
                                        {{ form.name_arabic(class="form-control") }}
                                        {% if form.name_arabic.errors %}
                                            <div class="text-danger">{{ form.name_arabic.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- اسم الموظف بالإنجليزي -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.name_english.label(class="form-label") }}
                                        {{ form.name_english(class="form-control") }}
                                        {% if form.name_english.errors %}
                                            <div class="text-danger">{{ form.name_english.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- رقم الهوية -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.national_id.label(class="form-label") }}
                                        <span class="text-danger">*</span>
                                        {{ form.national_id(class="form-control") }}
                                        {% if form.national_id.errors %}
                                            <div class="text-danger">{{ form.national_id.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- سارية الهوية -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.id_validity.label(class="form-label") }}
                                        <span class="text-danger">*</span>
                                        {{ form.id_validity(class="form-select") }}
                                        {% if form.id_validity.errors %}
                                            <div class="text-danger">{{ form.id_validity.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- تاريخ انتهاء الهوية -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.id_expiry_date.label(class="form-label") }}
                                        <span class="text-danger">*</span>
                                        {{ form.id_expiry_date(class="form-control") }}
                                        {% if form.id_expiry_date.errors %}
                                            <div class="text-danger">{{ form.id_expiry_date.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- تاريخ الميلاد -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.birth_date.label(class="form-label") }}
                                        <span class="text-danger">*</span>
                                        {{ form.birth_date(class="form-control", id="birth_date") }}
                                        {% if form.birth_date.errors %}
                                            <div class="text-danger">{{ form.birth_date.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- العمر (تلقائي) -->
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">العمر</label>
                                        <input type="text" class="form-control" id="age" readonly>
                                        <small class="text-muted">يتم حساب العمر تلقائياً من تاريخ الميلاد</small>
                                    </div>
                                    
                                    <!-- الجنسية -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.nationality.label(class="form-label") }}
                                        <span class="text-danger">*</span>
                                        {{ form.nationality(class="form-control") }}
                                        {% if form.nationality.errors %}
                                            <div class="text-danger">{{ form.nationality.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- مكان الميلاد -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.birth_place.label(class="form-label") }}
                                        {{ form.birth_place(class="form-control") }}
                                        {% if form.birth_place.errors %}
                                            <div class="text-danger">{{ form.birth_place.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- الحالة الاجتماعية -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.marital_status.label(class="form-label") }}
                                        {{ form.marital_status(class="form-select") }}
                                        {% if form.marital_status.errors %}
                                            <div class="text-danger">{{ form.marital_status.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- الجنس -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.gender.label(class="form-label") }}
                                        <span class="text-danger">*</span>
                                        {{ form.gender(class="form-select") }}
                                        {% if form.gender.errors %}
                                            <div class="text-danger">{{ form.gender.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- جهة إصدار الهوية -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.id_issuer.label(class="form-label") }}
                                        {{ form.id_issuer(class="form-control") }}
                                        {% if form.id_issuer.errors %}
                                            <div class="text-danger">{{ form.id_issuer.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- رخصة القيادة -->
                                    <div class="col-md-6 mb-3">
                                        <div class="form-check">
                                            {{ form.has_driving_license(class="form-check-input", id="has_license") }}
                                            {{ form.has_driving_license.label(class="form-check-label") }}
                                        </div>
                                    </div>
                                    
                                    <!-- تاريخ انتهاء رخصة القيادة -->
                                    <div class="col-md-6 mb-3" id="license_expiry_div" style="display: none;">
                                        {{ form.license_expiry_date.label(class="form-label") }}
                                        {{ form.license_expiry_date(class="form-control") }}
                                        {% if form.license_expiry_date.errors %}
                                            <div class="text-danger">{{ form.license_expiry_date.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- بيانات التواصل -->
                        <div class="card mb-4">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0"><i class="fas fa-phone"></i> بيانات التواصل</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <!-- رقم الجوال -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.phone.label(class="form-label") }}
                                        <span class="text-danger">*</span>
                                        {{ form.phone(class="form-control") }}
                                        {% if form.phone.errors %}
                                            <div class="text-danger">{{ form.phone.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- رقم جوال إضافي -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.additional_phone.label(class="form-label") }}
                                        {{ form.additional_phone(class="form-control") }}
                                        {% if form.additional_phone.errors %}
                                            <div class="text-danger">{{ form.additional_phone.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- الإيميل -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.email.label(class="form-label") }}
                                        {{ form.email(class="form-control") }}
                                        {% if form.email.errors %}
                                            <div class="text-danger">{{ form.email.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- رقم جوال للطوارئ -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.emergency_phone.label(class="form-label") }}
                                        {{ form.emergency_phone(class="form-control") }}
                                        {% if form.emergency_phone.errors %}
                                            <div class="text-danger">{{ form.emergency_phone.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- عنوان السكن -->
                                    <div class="col-12 mb-3">
                                        {{ form.address.label(class="form-label") }}
                                        {{ form.address(class="form-control", rows="3") }}
                                        {% if form.address.errors %}
                                            <div class="text-danger">{{ form.address.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- بيانات العقد -->
                        <div class="card mb-4">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="mb-0"><i class="fas fa-file-contract"></i> بيانات العقد</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <!-- الراتب -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.salary.label(class="form-label") }}
                                        <span class="text-danger">*</span>
                                        {{ form.salary(class="form-control") }}
                                        {% if form.salary.errors %}
                                            <div class="text-danger">{{ form.salary.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- مدة العقد -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.contract_duration.label(class="form-label") }}
                                        <span class="text-danger">*</span>
                                        {{ form.contract_duration(class="form-control") }}
                                        {% if form.contract_duration.errors %}
                                            <div class="text-danger">{{ form.contract_duration.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- تاريخ توقيع العقد -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.contract_signing_date.label(class="form-label") }}
                                        <span class="text-danger">*</span>
                                        {{ form.contract_signing_date(class="form-control") }}
                                        {% if form.contract_signing_date.errors %}
                                            <div class="text-danger">{{ form.contract_signing_date.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- تاريخ انتهاء العقد -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.contract_end_date.label(class="form-label") }}
                                        <span class="text-danger">*</span>
                                        {{ form.contract_end_date(class="form-control") }}
                                        {% if form.contract_end_date.errors %}
                                            <div class="text-danger">{{ form.contract_end_date.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- تاريخ المباشرة -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.start_work_date.label(class="form-label") }}
                                        {{ form.start_work_date(class="form-control") }}
                                        {% if form.start_work_date.errors %}
                                            <div class="text-danger">{{ form.start_work_date.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- بنود العقد -->
                        <div class="card mb-4">
                            <div class="card-header bg-secondary text-white">
                                <h5 class="mb-0"><i class="fas fa-list"></i> بنود العقد</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <!-- المسمى الوظيفي -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.job_title.label(class="form-label") }}
                                        <span class="text-danger">*</span>
                                        {{ form.job_title(class="form-control") }}
                                        {% if form.job_title.errors %}
                                            <div class="text-danger">{{ form.job_title.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- نوع العقد -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.contract_type.label(class="form-label") }}
                                        <span class="text-danger">*</span>
                                        {{ form.contract_type(class="form-control") }}
                                        {% if form.contract_type.errors %}
                                            <div class="text-danger">{{ form.contract_type.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- فترة التجربة -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.probation_period.label(class="form-label") }}
                                        {{ form.probation_period(class="form-control") }}
                                        {% if form.probation_period.errors %}
                                            <div class="text-danger">{{ form.probation_period.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- عدد ساعات العمل -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.working_hours.label(class="form-label") }}
                                        {{ form.working_hours(class="form-control") }}
                                        {% if form.working_hours.errors %}
                                            <div class="text-danger">{{ form.working_hours.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- بند استلام البدلة -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.uniform_provision.label(class="form-label") }}
                                        <span class="text-danger">*</span>
                                        {{ form.uniform_provision(class="form-control") }}
                                        {% if form.uniform_provision.errors %}
                                            <div class="text-danger">{{ form.uniform_provision.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- اسم الشركة المشغلة -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.operating_company.label(class="form-label") }}
                                        <span class="text-danger">*</span>
                                        {{ form.operating_company(class="form-control") }}
                                        {% if form.operating_company.errors %}
                                            <div class="text-danger">{{ form.operating_company.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- بند توفير انترنت -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.internet_provision.label(class="form-label") }}
                                        <span class="text-danger">*</span>
                                        {{ form.internet_provision(class="form-control") }}
                                        {% if form.internet_provision.errors %}
                                            <div class="text-danger">{{ form.internet_provision.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- ملاحظات -->
                                    <div class="col-12 mb-3">
                                        {{ form.notes.label(class="form-label") }}
                                        {{ form.notes(class="form-control", rows="3") }}
                                        {% if form.notes.errors %}
                                            <div class="text-danger">{{ form.notes.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- الشرط الجزائي -->
                                    <div class="col-12 mb-3">
                                        {{ form.penalty_clause.label(class="form-label") }}
                                        {{ form.penalty_clause(class="form-control", rows="3") }}
                                        {% if form.penalty_clause.errors %}
                                            <div class="text-danger">{{ form.penalty_clause.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- بيانات العمل -->
                        <div class="card mb-4">
                            <div class="card-header bg-dark text-white">
                                <h5 class="mb-0"><i class="fas fa-building"></i> بيانات العمل</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <!-- القسم -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.department.label(class="form-label") }}
                                        <span class="text-danger">*</span>
                                        {{ form.department(class="form-control") }}
                                        {% if form.department.errors %}
                                            <div class="text-danger">{{ form.department.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- المركز -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.center.label(class="form-label") }}
                                        {{ form.center(class="form-control") }}
                                        {% if form.center.errors %}
                                            <div class="text-danger">{{ form.center.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- المربع -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.square.label(class="form-label") }}
                                        {{ form.square(class="form-control") }}
                                        {% if form.square.errors %}
                                            <div class="text-danger">{{ form.square.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- رقم المخيم -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.camp_number.label(class="form-label") }}
                                        {{ form.camp_number(class="form-control") }}
                                        {% if form.camp_number.errors %}
                                            <div class="text-danger">{{ form.camp_number.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- فترة العمل -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.work_shift.label(class="form-label") }}
                                        {{ form.work_shift(class="form-control") }}
                                        {% if form.work_shift.errors %}
                                            <div class="text-danger">{{ form.work_shift.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- نوع الموظف -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.employee_type.label(class="form-label") }}
                                        <span class="text-danger">*</span>
                                        {{ form.employee_type(class="form-select") }}
                                        {% if form.employee_type.errors %}
                                            <div class="text-danger">{{ form.employee_type.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- بيانات البنك -->
                        <div class="card mb-4">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0"><i class="fas fa-university"></i> بيانات البنك</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <!-- نوع البنك -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.bank_type.label(class="form-label") }}
                                        {{ form.bank_type(class="form-control") }}
                                        {% if form.bank_type.errors %}
                                            <div class="text-danger">{{ form.bank_type.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- رقم الآيبان -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.iban_number.label(class="form-label") }}
                                        {{ form.iban_number(class="form-control") }}
                                        {% if form.iban_number.errors %}
                                            <div class="text-danger">{{ form.iban_number.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- شهادة الآيبان -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.iban_certificate.label(class="form-label") }}
                                        {{ form.iban_certificate(class="form-control") }}
                                        {% if form.iban_certificate.errors %}
                                            <div class="text-danger">{{ form.iban_certificate.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- بنك إضافي -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.additional_bank.label(class="form-label") }}
                                        {{ form.additional_bank(class="form-control") }}
                                        {% if form.additional_bank.errors %}
                                            <div class="text-danger">{{ form.additional_bank.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- رقم الآيبان الإضافي -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.additional_iban.label(class="form-label") }}
                                        {{ form.additional_iban(class="form-control") }}
                                        {% if form.additional_iban.errors %}
                                            <div class="text-danger">{{ form.additional_iban.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- اسم المستفيد -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.beneficiary_name.label(class="form-label") }}
                                        {{ form.beneficiary_name(class="form-control") }}
                                        {% if form.beneficiary_name.errors %}
                                            <div class="text-danger">{{ form.beneficiary_name.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- رقم جوال المستفيد -->
                                    <div class="col-md-6 mb-3">
                                        {{ form.beneficiary_phone.label(class="form-label") }}
                                        {{ form.beneficiary_phone(class="form-control") }}
                                        {% if form.beneficiary_phone.errors %}
                                            <div class="text-danger">{{ form.beneficiary_phone.errors[0] }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- أزرار الحفظ -->
                        <div class="card">
                            <div class="card-body text-center">
                                <button type="submit" class="btn btn-success btn-lg me-3">
                                    <i class="fas fa-save"></i> حفظ الموظف
                                </button>
                                <a href="{{ url_for('employees') }}" class="btn btn-secondary btn-lg">
                                    <i class="fas fa-times"></i> إلغاء
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// حساب العمر تلقائياً
document.getElementById('birth_date').addEventListener('change', function() {
    const birthDate = new Date(this.value);
    const today = new Date();
    let age = today.getFullYear() - birthDate.getFullYear();
    const monthDiff = today.getMonth() - birthDate.getMonth();
    
    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
        age--;
    }
    
    document.getElementById('age').value = age + ' سنة';
});

// إظهار/إخفاء تاريخ انتهاء رخصة القيادة
document.getElementById('has_license').addEventListener('change', function() {
    const licenseDiv = document.getElementById('license_expiry_div');
    if (this.checked) {
        licenseDiv.style.display = 'block';
    } else {
        licenseDiv.style.display = 'none';
    }
});
</script>
{% endblock %}